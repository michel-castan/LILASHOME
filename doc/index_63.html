<html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>LILAS-V4</title><!--Généré dynamiquement par PubliTool 2009--><link href="index_2.css" rel="stylesheet"><script src="index_3.js" type="text/javascript">
   </script></head><body><div xmlns:url="http://whatever/java/java.net.URLEncoder" class="zoneTitre"><table class="zoneTitre" width="100%"><tr class="zoneTitre"><td class="colTitreLogo"><embed src="index_4.svg" type="image/svg+xml"></embed></td><td class="colTitreTxt">LILAS-V4</td></tr></table></div><div id="tocFixe"><ul><li class="niv0"><a href="index.html" onClick="return chargerURLavecHistorique(this)">LILAS-V4</a></li><li class="niv1"><a href="index_6.html" onClick="return chargerURLavecHistorique(this)">1 Installation</a></li><li class="niv1"><a href="index_7.html" onClick="return chargerURLavecHistorique(this)">2 Quick start tutorial</a></li><li class="niv1"><a href="index_19.html" onClick="return chargerURLavecHistorique(this)">3 Launch command</a></li><li class="niv1"><a href="index_20.html" onClick="return chargerURLavecHistorique(this)">4 Configuration file</a></li><li class="niv1"><a href="index_21.html" onClick="return chargerURLavecHistorique(this)">5 Lilas programming</a></li><li class="niv2"><a href="index_22.html" onClick="return chargerURLavecHistorique(this)">5.1 lilas.base</a></li><li class="niv2"><a href="index_26.html" onClick="return chargerURLavecHistorique(this)">5.2 lilas.awt</a></li><li class="niv2"><a href="index_40.html" onClick="return chargerURLavecHistorique(this)">5.3 lilas.script</a></li><li class="niv2"><a href="index_60.html" onClick="return chargerURLavecHistorique(this)">5.4 lilas.sm</a></li><li class="niv2"><a href="index_61.html" onClick="return chargerURLavecHistorique(this)">5.5 lilas.code</a></li><li class="niv3"><a href="index_62.html" onClick="return chargerURLavecHistorique(this)">5.5.1 logic</a></li><li class="niv3sel"><a href="index_63.html" onClick="return chargerURLavecHistorique(this)">5.5.2 vhdl</a></li><li class="niv1"><a href="index_64.html" onClick="return chargerURLavecHistorique(this)">6 lilas.bib</a></li><li class="niv1"><a href="index_88.html" onClick="return chargerURLavecHistorique(this)">7 FPGA board</a></li><li class="niv1"><a href="index_91.html" onClick="return chargerURLavecHistorique(this)">8 Lilas examples</a></li></ul></div><div class="zoneMain"><p class="H2c" xmlns:url="http://whatever/java/java.net.URLEncoder">
   - 5.5.2 -</p><p class="H2c" xmlns:url="http://whatever/java/java.net.URLEncoder">vhdl</p><p style="top:10pt;bottom:5mm;text-align:justify;" xmlns:url="http://whatever/java/java.net.URLEncoder">We can use the vhdl language for example when we want to use an item from the library provided by xilinx Spartan6 
	(<a href="http://www.xilinx.com/support/documentation/sw_manuals/xilinx14_7/spartan6_hdl.pdf">UG615</a>).
	For example, to use component DCM_SP, we use (the element &lt;name/&gt; will be replace by the module name 
	and &lt;portDecl/&gt; by a list of vhdl port declaration when
	executing the module with option <span style="font-family:monospace;">-to=vhdl</span>:
	<div class="" style="white-space:pre;background-color:#e7e3e7;margin:1cm"> <span style="background:#99FF66"><a href="index_166.lilas">DCM_SP.lilas</a> : </span><div class="" style="white-space:pre;font-family:monospace;background-color:#e7e3e7;margin-top:0.2cm;margin-left:1cm"><font color="#B88408">&lt;?</font><font color="#208820">xml version="1.0" encoding="UTF-8"</font><font color="#B88408">?&gt;</font>
<font color="#A020F0">&lt;module&gt;</font>
	<font color="#9A1900">&lt;!-- d&eacute;claration des attributs --&gt;</font>
	<font color="#A020F0">&lt;signal mode=</font><font color="#CC6600">"constant"</font> <font color="#A020F0">name=</font><font color="#CC6600">"CLKFX_MULTIPLY"</font> <font color="#A020F0">type=</font><font color="#CC6600">"java.lang.Integer"</font><font color="#A020F0">/&gt;</font>
	<font color="#A020F0">&lt;signal mode=</font><font color="#CC6600">"constant"</font> <font color="#A020F0">name=</font><font color="#CC6600">"CLKFX_DIVIDE"</font> <font color="#A020F0">type=</font><font color="#CC6600">"java.lang.Integer"</font><font color="#A020F0">/&gt;</font>
	<font color="#A020F0">&lt;signal mode=</font><font color="#CC6600">"constant"</font> <font color="#A020F0">name=</font><font color="#CC6600">"CLKIN_PERIOD"</font> <font color="#A020F0">type=</font><font color="#CC6600">"java.lang.Float"</font><font color="#A020F0">/&gt;</font>
    <font color="#A020F0">&lt;signal mode=</font><font color="#CC6600">"constant"</font> <font color="#A020F0">name=</font><font color="#CC6600">"printDelay"</font> <font color="#A020F0">type=</font><font color="#CC6600">"java.lang.Boolean"</font><font color="#A020F0">/&gt;</font>

	<font color="#9A1900">&lt;!-- d&eacute;claration des ports --&gt;</font>
	
	<font color="#A020F0">&lt;signal name=</font><font color="#CC6600">"clkIn"</font> <font color="#A020F0">mode=</font><font color="#CC6600">"in"</font> <font color="#A020F0">size=</font><font color="#CC6600">"1"</font> <font color="#A020F0">type=</font><font color="#CC6600">"lilas.type.StdLogic"</font><font color="#A020F0">/&gt;</font>
	<font color="#A020F0">&lt;signal name=</font><font color="#CC6600">"clkOut"</font> <font color="#A020F0">mode=</font><font color="#CC6600">"out"</font> <font color="#A020F0">size=</font><font color="#CC6600">"1"</font> <font color="#A020F0">type=</font><font color="#CC6600">"lilas.type.StdLogic"</font><font color="#A020F0">/&gt;</font>
	
	<font color="#A020F0">&lt;code language=</font><font color="#CC6600">"java"</font><font color="#A020F0">/&gt;</font>

	<font color="#A020F0">&lt;code language=</font><font color="#CC6600">"vhdl"</font><font color="#A020F0">&gt;</font>
entity <font color="#A020F0">&lt;name/&gt;</font> is
<font color="#A020F0">&lt;portDecl/&gt;</font>
end entity <font color="#A020F0">&lt;name/&gt;</font>;

architecture a_<font color="#A020F0">&lt;name/&gt;</font> of <font color="#A020F0">&lt;name/&gt;</font> is
<font color="#A020F0">&lt;![CDATA[</font>
	component DCM_SP
	generic(
		CLK_FEEDBACK : string :=  "1X";
        CLKDV_DIVIDE : real :=  2.0;
        CLKFX_DIVIDE : integer :=  1;
        CLKIN_PERIOD : real :=  10.0;
        CLKFX_MULTIPLY : integer :=  4;
        CLKIN_DIVIDE_BY_2 : boolean :=  FALSE;
        CLKOUT_PHASE_SHIFT : string :=  "NONE";
        DESKEW_ADJUST : string :=  "SYSTEM_SYNCHRONOUS";
        DFS_FREQUENCY_MODE : string :=  "LOW";
        DLL_FREQUENCY_MODE : string :=  "LOW";
        DSS_MODE : string :=  "NONE";
        DUTY_CYCLE_CORRECTION : boolean :=  TRUE;
        PHASE_SHIFT : integer :=  0;
        STARTUP_WAIT : boolean :=  FALSE;
        FACTORY_JF : bit_vector :=  x"C080");
	
	port(
		CLKFB : IN std_logic := '0';
		CLKIN : IN std_logic := '0';
		DSSEN : IN std_logic := '0';
		PSCLK : IN std_logic := '0';
		PSEN : IN std_logic := '0';
		PSINCDEC : IN std_logic := '0';
		RST : IN std_logic := '0';
		CLK0 : OUT std_logic := '0';
		CLK180 : OUT std_logic := '0';
		CLK270 : OUT std_logic := '0';
		CLK2X : OUT std_logic := '0';
		CLK2X180 : OUT std_logic := '0';
		CLK90 : OUT std_logic := '0';
		CLKDV : OUT std_logic := '0';
		CLKFX : OUT std_logic := '0';
		CLKFX180 : OUT std_logic := '0';
		LOCKED : OUT std_logic := '0';
		PSDONE : OUT std_logic := '0';
		STATUS : OUT std_logic_vector(7 downto 0) := "00000000");
	end component;
	
	signal zero1b : std_logic := '0';
	signal clk0 : std_logic := '0';
	signal PSCLK_openSignal : std_logic;
	
		
begin
	instDCM_SP : DCM_SP
	generic map (
		CLKDV_DIVIDE =&gt; 2.0, -- CLKDV divide value
							 -- (1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7,7.5,8,9,10,11,12,13,14,15,16).
		CLKFX_DIVIDE =&gt; CLKFX_DIVIDE, -- Divide value on CLKFX outputs - D - (1-32)
		CLKFX_MULTIPLY =&gt; CLKFX_MULTIPLY, -- Multiply value on CLKFX outputs - M - (2-32)
		CLKIN_DIVIDE_BY_2 =&gt; FALSE, -- CLKIN divide by two (TRUE/FALSE)
		CLKIN_PERIOD =&gt; CLKIN_PERIOD, -- Input clock period specified in nS
		CLKOUT_PHASE_SHIFT =&gt; "NONE", -- Output phase shift (NONE, FIXED, VARIABLE)
		CLK_FEEDBACK =&gt; "1X", -- Feedback source (NONE, 1X, 2X)
		DESKEW_ADJUST =&gt; "SYSTEM_SYNCHRONOUS", -- SYSTEM_SYNCHRNOUS or SOURCE_SYNCHRONOUS
		DFS_FREQUENCY_MODE =&gt; "LOW", -- Unsupported - Do not change value
		DLL_FREQUENCY_MODE =&gt; "LOW", -- Unsupported - Do not change value
		DSS_MODE =&gt; "NONE", -- Unsupported - Do not change value
		DUTY_CYCLE_CORRECTION =&gt; TRUE, -- Unsupported - Do not change value
		FACTORY_JF =&gt; X"c080", -- Unsupported - Do not change value
		PHASE_SHIFT =&gt; 0, -- Amount of fixed phase shift (-255 to 255)
		STARTUP_WAIT =&gt; FALSE -- Delay config DONE until DCM_SP LOCKED (TRUE/FALSE)
	)
	port map (
		CLK0 =&gt; clk0, -- 1-bit output: 0 degree clock output
		CLK180 =&gt; open, -- 1-bit output: 180 degree clock output
		CLK270 =&gt; open, -- 1-bit output: 270 degree clock output
		CLK2X =&gt; open, -- 1-bit output: 2X clock frequency clock output
		CLK2X180 =&gt; open, -- 1-bit output: 2X clock frequency, 180 degree clock output
		CLK90 =&gt; open, -- 1-bit output: 90 degree clock output
		CLKDV =&gt; open, -- 1-bit output: Divided clock output
		CLKFX =&gt; clkOut, -- 1-bit output: Digital Frequency Synthesizer output (DFS)
		CLKFX180 =&gt; open, -- 1-bit output: 180 degree CLKFX output
		LOCKED =&gt; open, -- 1-bit output: DCM_SP Lock Output
		PSDONE =&gt; open, -- 1-bit output: Phase shift done output
		STATUS =&gt; open, -- 8-bit output: DCM_SP status output
		CLKFB =&gt; clk0, -- 1-bit input: Clock feedback input
		CLKIN =&gt; clkIn, -- 1-bit input: Clock input
		DSSEN =&gt; zero1b, -- 1-bit input: Unsupported, specify to GND.
		PSCLK =&gt; PSCLK_openSignal, -- 1-bit input: Phase shift clock input
		PSEN =&gt; zero1b, -- 1-bit input: Phase shift enable
		PSINCDEC =&gt; zero1b, -- 1-bit input: Phase shift increment/decrement input
		RST =&gt; zero1b -- 1-bit input: Active high reset input
	);
	<font color="#A020F0">]]&gt;</font>
end architecture a_<font color="#A020F0">&lt;name/&gt;</font>;
<font color="#A020F0">&lt;/code&gt;</font>
<font color="#A020F0">&lt;/module&gt;</font>
</div></div>
	</p><p style="top:10pt;bottom:5mm;text-align:justify;" xmlns:url="http://whatever/java/java.net.URLEncoder">Of course, we must create a java module for the method activation&nbsp;: <div class="" style="white-space:pre;background-color:#e7e3e7;margin:1cm"> <span style="background:#99FF66"><a href="index_167.java">DCM_SP.java</a> : </span><div class="" style="white-space:pre;font-family:monospace;background-color:#e7e3e7;margin-top:0.2cm;margin-left:1cm"><font color="#009900">package</font><font color="#0000FF"> lilas.bib.logic.clock</font>;

<font color="#009900">import</font><font color="#0000FF"> lilas.Parameter</font>;
<font color="#009900">import</font><font color="#0000FF"> lilas.base.ExceptionLilas</font>;
<font color="#009900">import</font><font color="#0000FF"> lilas.base.Module</font>;
<font color="#009900">import</font><font color="#0000FF"> lilas.base.Signal</font>;
<font color="#009900">import</font><font color="#0000FF"> lilas.type.StdLogic</font>;

<font color="#009900">public</font> <font color="#009900">class</font> <font color="#0000FF">DCM_SP</font> <font color="#009900">extends</font> <font color="#0000FF">DCM_SP_LILAS</font>
{
	
	<font color="#009900">public</font> <font color="#0000FF">DCM_SP</font>(<font color="#0000FF">String</font> <font color="#FF00FF">nomDansModuleParent</font>, <font color="#0000FF">Module</font> <font color="#FF00FF">parent</font>,
			<font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">Integer</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">CLKFX_MULTIPLY_signal</font><font color="#FF00FF">,</font>
			<font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">Integer</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">CLKFX_DIVIDE_signal</font><font color="#FF00FF">,</font>
			<font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">Float</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">CLKIN_PERIOD_signal</font><font color="#FF00FF">,</font> 
		    <font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">java.lang.Boolean</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">printDelay_signal</font><font color="#FF00FF">,</font>
		    <font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">StdLogic</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">clkIn_signal</font><font color="#FF00FF">,</font>
			<font color="#0000FF">Signal</font><font color="#FF00FF">&lt;</font><font color="#0000FF">StdLogic</font><font color="#FF00FF">&gt;</font> <font color="#0000FF">clkOut_signal</font><font color="#FF00FF">)</font> <font color="#0000FF">throws</font> <font color="#FF00FF">ExceptionLilas</font> <font color="#0000FF">{</font>
		<font color="#FF00FF">super</font><font color="#0000FF">(</font><font color="#FF00FF">nomDansModuleParent</font>, <font color="#0000FF">parent</font><font color="#FF00FF">,</font> <font color="#0000FF">CLKFX_MULTIPLY_signal</font><font color="#FF00FF">,</font> <font color="#0000FF">CLKFX_DIVIDE_signal</font><font color="#FF00FF">,</font>
				<font color="#0000FF">CLKIN_PERIOD_signal</font><font color="#FF00FF">,</font> <font color="#0000FF">printDelay_signal</font><font color="#FF00FF">,</font> <font color="#0000FF">clkIn_signal</font><font color="#FF00FF">,</font> <font color="#0000FF">clkOut_signal</font><font color="#FF00FF">)</font><font color="#0000FF">;</font>
		<font color="#FF00FF">//</font><font color="#0000FF">clkOut_port</font><font color="#FF00FF">.</font><font color="#0000FF">propagate</font> <font color="#FF00FF">=</font> <font color="#0000FF">lilas</font><font color="#FF00FF">.</font><font color="#0000FF">base</font><font color="#FF00FF">.</font><font color="#0000FF">Port</font><font color="#FF00FF">.</font><font color="#0000FF">Propagate</font><font color="#FF00FF">.</font><font color="#0000FF">PERMANENT</font><font color="#FF00FF">;</font>
		<font color="#0000FF">Parameter.simulatedTimeMode</font> <font color="#FF00FF">=</font> <font color="#0000FF">true</font><font color="#FF00FF">;</font>
	<font color="#0000FF">}</font>

	<font color="#FF00FF">@Override</font>
	<font color="#0000FF">final</font> <font color="#FF00FF">protected</font> <font color="#0000FF">void</font> <font color="#FF00FF">activation</font><font color="#0000FF">(</font><font color="#FF00FF">)</font> <font color="#0000FF">throws</font> <font color="#FF00FF">lilas.base.ExceptionLilas</font> <font color="#0000FF">{</font>
		<font color="#FF00FF">long</font> <font color="#0000FF">demiPeriode</font> <font color="#FF00FF">=</font> <font color="#0000FF">(</font><font color="#FF00FF">CLKIN_PERIOD.longValue</font><font color="#0000FF">(</font><font color="#FF00FF">)</font><font color="#0000FF">*</font><font color="#FF00FF">1000</font><font color="#0000FF">*</font><font color="#FF00FF">CLKFX_DIVIDE</font>)/(2*CLKFX_MULTIPLY);<font color="#9A1900">// *1000 (ps) /2* (demiPeriode)
</font>		<font color="#009900">long</font> <font color="#FF00FF">freqIn</font> = (<font color="#009900">long</font>) (1000000000000L / (2*demiPeriode));
		System.out.println(<font color="#CC6600">""</font>+this.clkOut_port.signal.longVarName()+<font color="#CC6600">" : "</font>+(freqIn/1000000)+<font color="#CC6600">" Mhz"</font>);
		<font color="#9A1900">//System.out.println("demiPeriode="+demiPeriode+" ps");
</font>		<font color="#9A1900">//System.out.println("freqIn="+(freqIn/1000000)+" Mhz");
</font>		<font color="#009900">long</font> <font color="#FF00FF">dateProchainChangement</font> = demiPeriode;
		<font color="#009900">while</font> (true) {
			<font color="#9A1900">//printMsg("Wait for "+dateProchainChangement+" &agrave; "+systemL.getCurrentDate()+" "+this, java.awt.Color.orange);
</font>			waitDate(dateProchainChangement, true, true);
  			<font color="#009900">long</font> <font color="#FF00FF">retard</font> = systemL.getCurrentDate()-dateProchainChangement;
  			<font color="#009900">if</font> (retard!=0L) {
  				<font color="#009900">if</font> (printDelay &amp;&amp; lilas.Parameter.simulatedTimeMode) printMsg(<font color="#CC6600">""</font>+clkOut_port.signal.varName()+<font color="#CC6600">"="</font>+clkOut+<font color="#CC6600">" en retard de "</font>+retard+<font color="#CC6600">" &agrave; "</font>+systemL.getCurrentDate(), java.awt.Color.orange);
  				waitStable();
  				dateProchainChangement=systemL.getCurrentDate();
  			}
  			propagateOnce(<font color="#CC6600">"clkOut"</font>, lilas.type.StdLogic.not(clkOut));
			dateProchainChangement = dateProchainChangement + demiPeriode;
			<font color="#009900">if</font> (!lilas.Parameter.simulatedTimeMode) dateProchainChangement+=retard;
		}
	}
}

</div></div></p></div></body></html>